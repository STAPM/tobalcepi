---
title: "Smoking disease risks"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{smoke_risks}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: disease-risks.bib
link-citations: yes
citation_package: natbib
biblio-style: vancouver
urlcolor: blue
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.pos = 'H'
)
```

```{r setup, include = FALSE, results = 'hide', warning = FALSE, eval = T}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(magrittr))
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(testthat))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(tobalcepi))
suppressPackageStartupMessages(library(readxl))
```

## Summary
In the Sheffield Tobacco Policy Model (STPM), we consider 52 adult diseases related to smoking and the corresponding relative risks of developing these diseases in current vs. never smokers, and in former smokers according to the time since they quit [@Webster2018]. For current smokers, we assume that the relative risks of disease are the same for all smokers regardless of the amount currently smoked and the length of time as a smoker. We limit ourselves to diseases that affect the consumer themselves e.g. excluding secondary effects of smoking.  

## Use of relative risks in STPM
The functions to assign relative risks to each individual based on their current or former smoking status are in the `tobalcepi` R package, which is part of the set of R packages containing the code that underlies STPM.  

The function `RRFunc()` does the job of assigning the relative risks of each disease to a sample of individuals according to their current tobacco consumption status. Since STPM is a part of our joint programme of modelling across tobacco and alcohol, `RRFunc()` has options that can tailor it to assign risks based on tobacco consumption only, alcohol consumption only, or both tobacco and alcohol consumption.  

For tobacco, the relative risk for each individual is calculated based on whether they are a current, former or never smoker. Currently, all current smokers have the same relative risk regardless of the amount they currently smoke or have smoked in the past. Former smokers are initially given the relative risk associated with current smokers, which we then scale according to a disease-specific function that describes how risk declines after quitting smoking.  

The first step carried out by `RRFunc()` is to assign both current and former smokers the relative risk for each disease associated with current smoking. It does this using the function `RRTob()`. For former smokers, we estimate the risk in former smokers using the equation  

\begin{equation}
R_{former}=1+[R_{current}-1][1-p(t)],  
\end{equation}

in which the relative risk ($R$) associated with current smoking is scaled according to our estimates of the proportional reduction in the risk ($p$) associated with their number of years ($t$) as a former smoker. After someone has been quit for 40 years, we assume their risk reverts back to be the same as a never smoker.  

The current version of STPM models the individual-level dynamics of smoking and the associated risks of disease, but it links these to the population-level trends in the rates of morbidity and mortality from each disease. In other words, STPM models the direct link between smoking and disease prevalence rather than modelling the link between smoking and disease incidence (which would then have a knock-on effect to prevalence).  

We define the effect of an intervention on the rates of disease morbidity and mortality in terms of a proportional change, stratified by year, age, sex and quintiles of the Index of Multiple Deprivation. The proportional change is the ratio of the average risks in each of these subgroups in the treatment compared to the control arms of the model (see the STPM vignette for further details). This proportional change is also known as the 'potential impact fraction' (*PIF = ratio of weighted average revised risk given a policy to the weighted average baseline risk given current consumption levels*). The PIF approach to updating the population-level rates of morbidity and mortality originated in the *PREVENT* model [@Gunningschepers1989] and was extend to underlie the Sheffield Alcohol Policy Model [@Brennan2015].  

Thus, after assigning each individual ($i$) a relative risk for each disease ($h$) based on their current smoking status, we then calculate the average risk ($\bar{R}$) across the $N$ individuals in each subgroup ($s$)  

\begin{equation}
\bar{R}_s^h= \frac{1}{N_s}\sum_{i\in{s}}R^h_i.  
\end{equation}

This average risk is calculated by the function `subgroupRisk()`. The functon `UpdateHarm()` in the `stapmr` R package calculates and applies the PIF.  

The `tobalcepi` package contains data on smoking from the Health Survey for England, 2001-2016 in `hse_data_smoking`. To illustrate, we take a subset of 10,000 individuals from these data, assign them their smoking attributable relative risks for laryngeal cancer, and calculate the average risk for males and females.  


## Code development
To integrate dose-response risk functions into our modelling, we have started to develop a new function to replace `RRtob()`. The function `RRTobDR` estimates each individual in the data their dose-response relative risk based on the number of cigarettes they consume per day. This function has not yet been integrated into the function `RRFunc()`.    


## References




































































































